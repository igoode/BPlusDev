<apex:page standardController="Employer_Contact__c" 
        extensions="BPEmployerContactExtension,BPHomeController"
        standardStylesheets="true" 
        showHeader="false"
        action="{!getEmployerAddress}">
    <apex:variable var="newReferral" value="{!NOT(ISBLANK(Employer.ID)) || NOT(ISBLANK(Vacancy.ID))}" />
    <apex:stylesheet value="{!URLFOR($Resource.NewFollowupStyles)}" />
    <style>
        .bPageTitle 
        {
            margin-bottom:0px !important;
        }
        .datePicker
        {
            z-index: 102 !important;
        }
    </style>
    <script>     
        $j(document).ready(function()
            {
                
            });  
        function showSearch()
        {
            $j(function() {
                $j("#dialog-search").dialog(
                    {
                        height: 650,
                        width: 800,
                        modal: false,
                        position: {my: "center"},
                        buttons: 
                            {
                                Cancel: function() 
                                {
                                    $j(this).dialog("close");
                                }
                            }
                    });

                
                }); 
        }                     
    </script>
    <apex:variable value="{!Employer_Contact__c}" var="ec" />
    <apex:outputPanel layout="block" id="wrapper">
        <apex:composition template="BPTemplate" />
        <script>       
            $j(function() {
                $j("#tabs").tabs();
            });

            $j(document).ready(function()
            {
                $j('.newFuDiv').hide();                
                $j("#dialog-search").hide();
                $j('#placedPnl').hide();
                $j('#newFuBtn').click(function()
                {
                    $j('.newFuDiv').show();
                });
                $j('#placedBtn').click(function()
                {
                    $j('#placedPnl').dialog(
                    {
                        height: 200,
                        width: 500,
                        modal: true,
                        position: {my: "center"},
                        buttons: 
                            {
                                Close: function() 
                                {
                                    $j(this).dialog("close");
                                }
                            }
                    });
                });
            });
        </script>
        <apex:form id="frm">
            <div class="end-inner end-contacts">
                <c:BPNavBar JobSeeker="{!IF(ISBLANK($CurrentPage.parameters.empId), JobSeeker, null)}" />
                <div class="subsection end-banner">
                     <apex:image value="{!URLFOR($Resource.EndiceResources, 'banner.jpg')}"/>
                </div>
                <div id="content">
                    <div class="end-contact">
                        <apex:sectionHeader title="{!IF(newReferral, 'New Referral', 'Employer Contact')}" />  
                        <apex:pageMessages id="msgs" />      
                        <apex:pageBlock >
                            <div class="end-contact-block end-contact-employer">
                                <apex:pageblockSection columns="2" rendered="{!NOT(newReferral)}">
                                    <apex:outputfield value="{!ec.Job_Seeker__c}"/> 
                                    <apex:outputfield value="{!ec.Business__c}" label="Employer"/>
                                    <apex:outputfield value="{!ec.Contacted_On__c}"/>
                                    <apex:outputfield value="{!ec.Address__c}"/>
                                    <apex:outputfield value="{!ec.Contact_Number__c}"/>
                                    <apex:outputfield value="{!ec.Alternative_Contact_Number__c}"/>
                                    <apex:outputfield value="{!ec.Contact_Person__c}"/>
                                    <apex:outputfield value="{!ec.Contact_Position__c}"/>
                                    <apex:outputfield value="{!ec.Result__c}" />
                                    <apex:outputfield value="{!ec.Call_Back_Date__c}"/>
                                    <apex:outputfield value="{!ec.Call_Back_Time__c}"/>
                                    <apex:outputfield value="{!ec.Job_Title__c}"/>
                                </apex:pageblockSection> 
                                <apex:pageblockSection columns="1" rendered="{!NOT(newReferral)}">
                                    <apex:inputfield value="{!ec.Comment__c}" styleClass="comment"/>
                                    <apex:outputPanel >
                                        <div class="fuHdr fill">
                                            <span>
                                                Do you want to create a new followup reminder?<button type="button" class="btn" id="newFuBtn">Yes</button>
                                            </span>
                                        </div>
                                        <apex:outputPanel layout="block" styleClass="newFuDiv">
                                           <c:BPCreateFollowup EmployerContactID="{!ec.ID}" 
                                                ParentDivClass="newFuDiv"  
                                                divClass="mapDataInline"/>
                                        </apex:outputPanel>
                                    </apex:outputPanel>
                                </apex:pageBlockSection>
                                <apex:pageblockSection columns="2" rendered="{!newReferral}">
                                    <apex:pageBlockSectionItem >
                                        <apex:outputLabel value="Job Seeker"/>
                                        <apex:outputPanel id="pnlJs" layout="block" style="width:200px">
                                            <apex:outputField value="{!ec.Job_Seeker__c}" /> 
                                            <apex:inputHidden value="{!ec.Job_Seeker__c}" /> 
                                            <button type="button" 
                                                    onclick="showSearch();" 
                                                    class="btn"
                                                    style="float:right">
                                                Find Jobseeker
                                            </button>
                                        </apex:outputPanel>
                                    </apex:pageBlockSectionItem>
                                    <apex:pageBlockSectionItem />
                                    <apex:outputfield value="{!Employer.Name}" label="Employer" rendered="{!NOT(ISBLANK(Employer.ID))}"/>
                                    <apex:outputfield value="{!ec.Business__c}" label="Employer" rendered="{!NOT(ISBLANK(Vacancy.ID))}"/>
                                    <apex:inputField value="{!ec.Contacted_On__c}"/>
                                    <apex:inputField value="{!ec.Contact_Number__c}"/>
                                    <apex:inputField value="{!ec.Alternative_Contact_Number__c}"/>
                                    <apex:inputField value="{!ec.Contact_Person__c}"/>
                                    <apex:inputField value="{!ec.Contact_Position__c}"/>
                                    <apex:inputfield value="{!ec.Result__c}">
                                        <apex:actionSupport reRender="iview,resume,msgs" event="onchange" />
                                    </apex:inputfield>
                                </apex:pageblockSection> 
                                <apex:pageblockSection columns="1" rendered="{!newReferral}">    
                                    <apex:inputfield value="{!ec.Comment__c}" styleClass="comment"/>                                    
                                </apex:pageblockSection>  
                            </div>                
                            <div class="end-contact-block end-contact-interview">
                                <apex:outputPanel id="iview">
                                    <apex:pageblockSection columns="2" 
                                            rendered="{!ec.Result__c == 'Call back' && newReferral}">
                                        <apex:inputfield value="{!ec.Call_Back_Date__c}"/> 
                                        <apex:inputfield value="{!ec.Call_Back_Time__c}"/>                                        
                                    </apex:pageblockSection>
                                    <apex:pageblockSection columns="2" 
                                            rendered="{!ec.Result__c == Interview && NOT(newReferral)}">
                                        <apex:outputfield value="{!ec.Interview_Date__c}"/>
                                        <apex:outputfield value="{!ec.Interview_Time__c}"/>
                                        <apex:outputfield value="{!ec.Job_Title__c}"/>
                                        <apex:outputfield value="{!ec.Job_Details__c}"/>                                        
                                    </apex:pageblockSection>
                                    <apex:pageblockSection columns="2" 
                                            rendered="{!(ec.Result__c == Interview || ec.Result__c = ResumeDropOff) && newReferral}">
                                        <apex:inputfield value="{!ec.Interview_Date__c}"/>
                                        <apex:inputfield value="{!ec.Interview_Time__c}"/>
                                        <apex:inputfield value="{!ec.Job_Title__c}"/>
                                        <apex:inputfield value="{!ec.Job_Details__c}"/>
                                        <apex:pageBlockSectionItem >
                                            <apex:outputLabel value="Address"/>
                                            <apex:outputPanel >
                                                <apex:inputfield value="{!ec.Address__c}"/>
                                                <em style="color:red;font-weight:bold">Confirm Address Details</em>
                                            </apex:outputPanel>
                                        </apex:pageBlockSectionItem>
                                    </apex:pageblockSection>
                                </apex:outputPanel>
                            </div>
                            <div class="end-contact-block end-contact-donotdisturb">
                                <apex:pageblockSection columns="2"
                                         rendered="{!BLANKVALUE(ec.Business__r.Do_Not_Disturb_Expiry__c, TODAY()) > TODAY()}">
                                    <apex:outputfield value="{!ec.Business__r.Do_Not_Disturb_Expiry__c}"/>
                                </apex:pageblockSection>   
                            </div>
                            <div class="end-contact-block end-contact-buttons">
                                <apex:pageBlockButtons location="bottom">  
                                    <apex:outputPanel id="btns">
                                        <apex:outputPanel layout="inline" 
                                                styleClass="mapData"
                                                rendered="{!NOT(ISBLANK(ec.ID)) && (ec.Result__c == Interview || ec.Result__c = ResumeDropOff)}">
                                            <span>Jobseeker Mobile Number</span>
                                            <apex:inputText value="{!MobileNumber}" />
                                            <apex:commandButton action="{!smsDetails}" 
                                                    reRender="msgs,msgs2"
                                                    styleClass="srchRsltBtn"
                                                    value="SMS Employer Details to Jobseeker"
                                                    status="spinner" />
                                        </apex:outputPanel>                                                                        
                                        <apex:commandButton value="Save" 
                                                action="{!saveOverride}" 
                                                status="spinner" 
                                                reRender="wrapper,msgs"/>
                                        <a href="javascript:openNewWindow('{!URLFOR($Page.BPWageSubsidy, null, [empId=ec.Business__c,jskId=JobSeeker.ID])}', 'BPWageSubsidy', '800px', '1000px');"                                                                 
                                            class="btn">
                                            Send....
                                        </a>   
                                        <apex:commandButton value="Back to Employer" 
                                                action="{!URLFOR($Page.BPEmployer, null, [id=Employer.ID])}" 
                                                styleClass="btn" 
                                                rendered="{!NOT(ISBLANK(Employer.ID))}"
                                                reRender="msgs"/>
                                        <apex:commandButton value="Create Vacancy" 
                                                action="{!URLFOR($Page.BPVacancy, null, [empId=ec.Business__c])}" 
                                                styleClass="btn"/>
                                        <input type="button"
                                                id="placedBtn" 
                                                class="btn"
                                                value="Jobseeker Placed" />
                                    </apex:outputPanel>  
                                </apex:pageBlockButtons> 
                            </div>
                        </apex:pageBlock>
                        <div class="end-job-seeker-tools" >
                            <apex:pageBlock rendered="{!NOT(ISBLANK(ec.ID))}">
                                <div id="tabs" style="height: 200px;overflow: auto;">
                                    <ul>
                                        <li><a href="#tabs-1">Followups</a></li>
                                    </ul>
                                    <div id="tabs-1" class="end-job-seeker-tools" >
                                        <apex:pageBlockSection columns="1">
                                            <apex:pageBlockTable value="{!Followups}" var="fu" >
                                                <apex:column >
                                                    <a class="btn" target="_parent" href="javascript:goPage('{!fu.ID}');">
                                                        Edit
                                                    </a>
                                                </apex:column>
                                                <apex:column value="{!fu.Type__c}"  />        
                                                <apex:column value="{!fu.Due_Date__c}" />
                                                <apex:column value="{!fu.Actioned__c}" />
                                                <apex:column value="{!fu.Comment__c}" />
                                            </apex:pageBlockTable>
                                        </apex:pageBlockSection>
                                    </div>
                                </div>
                            </apex:pageBlock>
                        </div>
                    </div>
                </div>
            </div>
        </apex:form>  
        <div id="placedPnl" style="height:50px">
            <c:BPPlaced PageController="{!ThisController}" EmployerID="{!ec.Business__c}" EmployerContactID="{!ec.ID}"/>
        </div>
        <div id="dialog-search" class="spielPnl end-search" title="Find Jobseeker">
            <apex:pageMessages id="srchMsgs" />
            <apex:form >
                <script>    
                    function selectJS(jsId)
                    {
                        populateJs(jsId);
                    }
                </script>
                <apex:actionFunction name="populateJs" 
                        action="{!getJobSeeker}" 
                        oncomplete="$j('#dialog-search').dialog('close');" 
                        rerender="pnlJs,msgs" >
                    <apex:param name="jsId" value="" />
                 </apex:actionFunction>

                <apex:pageBlock >
                    <apex:pageBlockSection >
                        <apex:pageBlockSectionItem >
                            <apex:outputLabel value="Name or ID"/>
                            <apex:outputPanel >
                                <apex:inputText value="{!JobSeekerSearch}" />
                                <apex:commandButton action="{!searchJS}" value="Search" reRender="srchRslts,srchMsgs" />
                            </apex:outputPanel>
                        </apex:pageBlockSectionItem>
                    </apex:pageBlockSection>
                    <apex:outputPanel id="srchRslts" >
                        <apex:outputPanel rendered="{!JobSeekerSearchResults.size == 0}">
                            No jobseekers found
                        </apex:outputPanel>
                        <apex:pageBlockTable value="{!JobSeekerSearchResults}" 
                                            var="jss"
                                            rendered="{!JobSeekerSearchResults.size > 0}"
                                            rows="10">
                            <apex:facet name="caption">
                                Jobseeker Search Results
                            </apex:facet>
                            <apex:column value="{!jss.Name}" 
                                    onclick="selectJS('{!jss.ID}');"/>
                            <apex:column value="{!jss.Assigned_To__r.Name}" 
                                    onclick="selectJS('{!jss.ID}');"
                                    rendered="{!IsManager}"/>
                            <apex:column value="{!jss.Marketing_Started__c}" 
                                    onclick="selectJS('{!jss.ID}');"/> 
                        </apex:pageBlockTable>
                        <apex:outputPanel rendered="{!JobSeekerSearchResults.size > 10}">
                            <br/>More jobseekers found that could not be displayed, try narrowing your search
                        </apex:outputPanel>
                    </apex:outputPanel>
                </apex:pageBlock>
            </apex:form>
        </div>         
        
    </apex:outputPanel>   
    <!--<apex:composition template="BPFooter" />-->
</apex:page>